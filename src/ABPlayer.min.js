function isMobile(){var e=!1;return function(t){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0)}(navigator.userAgent||navigator.vendor||window.opera),e}Array.from=Array.from||function(e){return[].slice.call(e)};var ABP={version:"0.8.0"};ABP.Strings={statsPlayer:_t("statsPlayer"),statsVideo:_t("statsVideo"),statsBuffer:_t("statsBuffer"),statsBufferClip:_t("statsBufferClip"),statsMozParse:_t("statsMozParse"),statsMozDecode:_t("statsMozDecode"),statsMozPaint:_t("statsMozPaint"),statsWebkitDecode:_t("statsWebkitDecode"),statsPresent:_t("statsPresent"),statsDrop:_t("statsDrop"),statsMimetype:_t("statsMimetype"),statsVideoBitrate:_t("statsVideoBitrate"),statsAudioBitrate:_t("statsAudioBitrate"),statsCurrentBitrate:_t("statsCurrentBitrate"),statsRealtimeBitrate:_t("statsRealtimeBitrate"),overallBitrate:_t("overallBitrate"),statsDownloadSpeed:_t("statsDownloadSpeed"),sendSmall:_t("sendSmall"),sendMid:_t("sendMid"),sendSize:_t("sendSize"),sendMode:_t("sendMode"),sendTop:_t("sendTop"),sendScroll:_t("sendScroll"),sendBottom:_t("sendBottom"),send:_t("send"),sendStyle:_t("sendStyle"),sendColor:_t("sendColor"),commentSpeed:_t("commentSpeed"),commentScale:_t("commentScale"),commentOpacity:_t("commentOpacity"),commentBlock:_t("commentBlock"),playSpeed:_t("playSpeed"),playSpeedReset:_t("playSpeedReset"),displayScaleD:_t("displayScaleD"),displayScaleF:_t("displayScaleF"),shieldTypeText:_t("shieldTypeText"),shieldTypeUser:_t("shieldTypeUser"),shieldTypeColor:_t("shieldTypeColor"),shieldTypeSetting:_t("shieldTypeSetting"),shieldAdd:_t("shieldAdd"),shieldUseRegex:_t("shieldUseRegex"),shieldBlockTop:_t("shieldBlockTop"),shieldBlockBottom:_t("shieldBlockBottom"),shieldBlockVisitor:_t("shieldBlockVisitor"),shieldRepeat:_t("shieldRepeat"),viewers:_t("viewers"),comments:_t("comments"),commentTime:_t("commentTime"),commentContent:_t("commentContent"),commentDate:_t("commentDate"),showStats:_t("showStats"),loadingMeta:_t("loadingMeta"),switching:_t("switching"),fetchURL:_t("fetchURL"),buffering:_t("buffering"),play:_t("play"),pause:_t("pause"),mute:_t("mute"),unmute:_t("unmute"),muteNotSupported:_t("muteNotSupported"),fullScreen:_t("fullScreen"),exitFullScreen:_t("exitFullScreen"),webFull:_t("webFull"),exitWebFull:_t("exitWebFull"),wideScreen:_t("wideScreen"),exitWideScreen:_t("exitWideScreen"),sendTooltip:_t("sendTooltip"),showComment:_t("showComment"),hideComment:_t("hideComment"),loopOn:_t("loopOn"),loopOff:_t("loopOff"),usingCanvas:_t("usingCanvas"),usingCSS:_t("usingCSS"),useCSS:_t("useCSS"),autoOpacityOn:_t("autoOpacityOn"),autoOpacityOff:_t("autoOpacityOff"),settings:_t("settings"),copyComment:_t("copyComment"),findComment:_t("findComment"),blockContent:_t("blockContent"),blockUser:_t("blockUser"),blockColor:_t("blockColor"),blockColorWhite:_t("blockColorWhite"),copyFail:_t("copyFail"),blockUserEmpty:_t("blockUserEmpty"),blockColorEmpty:_t("blockColorEmpty"),repeatPcs:_t("repeatPcs"),repeatUnlimited:_t("repeatUnlimited"),dragControlLowInc:_t("dragControlLowInc"),dragControlLowDec:_t("dragControlLowDec"),dragControlMedInc:_t("dragControlMedInc"),dragControlMedDec:_t("dragControlMedDec"),dragControlHighInc:_t("dragControlHighInc"),dragControlHighDec:_t("dragControlHighDec"),dragControlCancel:_t("dragControlCancel"),settComment:_t("settComment"),recordPlaySpeed:_t("recordPlaySpeed"),settPlayer:_t("settPlayer"),autoPlay:_t("autoPlay"),defaultWide:_t("defaultWide"),defaultFull:_t("defaultFull")},function(){"use strict";if(ABP){var e=jQuery,t=window.setTimeout,a=window.clearTimeout,i="addEventListener",o="HTML5 Player ver.170426 based on ABPlayer-bilibili-ver",n=[0,0],l=function(e){var t=n;return n=[e.clientX,e.clientY],!(t[0]==n[0]&&t[1]==n[1])},s=function(e){return document.getElementById(e)},r=function(e,t,a,i){var o=null;if("text"===e)return document.createTextNode(t);o=document.createElement(e);for(var n in t)if("style"!==n&&"className"!==n)o.setAttribute(n,t[n]);else if("className"===n)o.className=t[n];else for(var l in t.style)o.style[l]=t.style[l];if(a)for(var s=0;s<a.length;s++)null!=a[s]&&o.appendChild(a[s]);return i&&"function"==typeof i&&i(o),o},c=function(e,t){for(;e;e=e.parentNode)if(h(e.parentNode,t))return e};HTMLElement.prototype.tooltip=function(e){this.tooltipData=e,this.dispatchEvent(new Event("updatetooltip"))},"undefined"==typeof HTMLElement.prototype.requestFullScreen&&(HTMLElement.prototype.requestFullScreen=function(){this.webkitRequestFullscreen?this.webkitRequestFullscreen():this.mozRequestFullScreen?this.mozRequestFullScreen():this.msRequestFullscreen&&this.msRequestFullscreen()}),"undefined"==typeof document.isFullScreen&&(document.isFullScreen=function(){return document.webkitIsFullScreen||document.mozFullScreen||document.msFullscreenEnabled}),"undefined"==typeof document.exitFullscreen&&(document.exitFullscreen=function(){document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():window.msExitFullscreen&&msExitFullscreen()});var d=function(e,t){t=t||2;for(var a=""+e;a.length<t;)a="0"+a;return a},m=function(e,t){for(var a="",i=1;i<=t-(e+"").length;i++)a+="0";return a+e},u=function(e,t){if(0==e)return lang.oneDay;var a,i,o,n,l,s,r=new Date(1e3*parseInt(e));return a=String(r.getFullYear()),i=String(r.getMonth()+1),1==i.length&&(i="0"+i),o=String(r.getDate()),1==o.length&&(o="0"+o),n=String(r.getHours()),1==n.length&&(n="0"+n),l=String(r.getMinutes()),1==l.length&&(l="0"+l),s=String(r.getSeconds()),1==s.length&&(s="0"+s),String(t?i+"-"+o+" "+n+":"+l:a+"-"+i+"-"+o+" "+n+":"+l+":"+s)},p=function(e){return isNaN(e)?"00:00":m(parseInt(e/60),2)+":"+m(parseInt(e%60),2)},v=function(e){for(var t=e.split(":"),a=0,i=0;i<t.length;i++){a*=60;var o=parseInt(t[i]);if(isNaN(o)||0>o)return!1;a+=o}return a},f=function(e,o,n){if(e){e[i]("mousemove",function(t){var a,i=s("ABP-Tooltip"),l=e.clientWidth,d=e.clientHeight,m=e.getBoundingClientRect(),u=c(e,"ABP-Unit").parentNode,p=u.getBoundingClientRect(),v=m.top-p.top,f=o?t.clientX-p.left:m.left-p.left,g=f;null==i&&(i=r("div",{id:"ABP-Tooltip"},[r("text",e.tooltipData)]),i.by=e,u.appendChild(i),i.style.top=v+d+2+"px",i.style.left=f+l/2-i.clientWidth/2+"px",g+=l/2-i.clientWidth/2),o&&(i.style.left=f-i.clientWidth/2+"px",g-=l/2),a=i.getBoundingClientRect(),a.left<p.left?i.style.left="0px":a.right>p.right&&(i.style.left=p.width-a.width+"px"),n=n||-6,n&&(i.style.top=v-i.clientHeight+2+n+"px")});var l=function(){var e=s("ABP-Tooltip");e&&e.parentNode&&e.remove()},d=null;e[i]("mouseout",l),e[i]("touchend",function(){null!=d&&(a(d),d=null),d=t(function(){d=null,l()},2e3)}),e[i]("updatetooltip",function(t){var a=s("ABP-Tooltip");a&&a.by==t.target&&(a.innerHTML=e.tooltipData)})}},g=function(e,t){if(null!=e){var a=e.className.split(" ");""==a[0]&&(a=[]),a.indexOf(t)<0&&a.push(t),e.className=a.join(" ")}},h=function(e,t){if(null==e)return!1;var a=e.className.split(" ");return""==a[0]&&(a=[]),a.indexOf(t)>=0},y=function(e,t){if(null!=e){var a=e.className.split(" ");""==a[0]&&(a=[]),a.indexOf(t)>=0&&a.splice(a.indexOf(t),1),e.className=a.join(" ")}},b=function(e,t){var a={};for(var i in t)a[i]=e&&"undefined"!=typeof e[i]?e[i]:t[i];return a};ABP.create=function(e,t){var a=e;if(t||(t={}),ABP.playerConfig=t.config?t.config:{},t=b(t,{replaceMode:!0,width:512,height:384,src:""}),"string"==typeof e&&(a=s(e)),h(a,"ABP-Unit"))n=a;else{var n=r("div",{className:"ABP-Unit",style:{width:t.width.toString().indexOf("%")>=0?t.width:t.width+"px",height:t.height.toString().indexOf("%")>=0?t.height:t.height+"px"}});a.appendChild(n)}n.children.length>0&&t.replaceMode&&(n.innerHTML="");var l=[],c=[];if("string"==typeof t.src)t.src=r("video",{autobuffer:"true",dataSetup:"{}"},[r("source",{src:t.src})]),l.push(t.src);else if(t.src.hasOwnProperty("playlist"))for(var d=t.src,m=d.playlist,u=0;u<m.length;u++){if(m[u].hasOwnProperty("sources")){var p=[];for(var v in m[u].sources)p.push(r("source",{src:m[u][v],type:v}));l.push(r("video",{autobuffer:"true",dataSetup:"{}"},p))}else m[u].hasOwnProperty("video")&&l.push(m[u].video);c.push(m[u].comments)}else l.push(t.src);n.appendChild(r("div",{className:"ABP-Player"},[r("div",{className:"ABP-Video",tabindex:"10"},[r("div",{id:"ABP-info-box",style:{opacity:1}},[r("div",{className:"text-wrapper"},[r("div",{},[r("text",ABP.Strings.loadingMeta)])]),r("div",{id:"dots"})]),r("div",{className:"ABP-Container"},[r("div",{className:"cmt",style:{left:0}},[r("text","　")])]),l[0],r("div",{className:"Player-Stats"},[r("div",{id:"player-dimension"},[r("span",{className:"stats_name"},[r("text",ABP.Strings.statsPlayer)]),r("span")]),r("div",{id:"video-dimension"},[r("span",{className:"stats_name"},[r("text",ABP.Strings.statsVideo)]),r("span")]),r("div",{id:"mimeType"},[r("span",{className:"stats_name"},[r("text",ABP.Strings.statsMimetype)]),r("span")]),r("div",{id:"buffer-health"},[r("span",{className:"stats_name"},[r("text",ABP.Strings.statsBuffer)]),r("span",{className:"stats-column",id:"buffer-health-column"}),r("span")]),r("div",{style:{position:"relative"}},[r("span",{className:"stats_name"},[r("text",ABP.Strings.statsBufferClip)]),r("span",{id:"buffer-clips"},[r("span"),r("span",{},[r("div",{style:{width:"1px",height:"400%",top:"-150%",position:"absolute",background:"#FFF",left:0}})])]),r("pre",{style:{position:"absolute",margin:0,left:"250px",width:"90px",fontFamily:"inherit"}})]),r("br",{className:"flvjs"}),r("div",{className:"flvjs"},[r("span",{className:"stats_name"},[r("text","fps：")]),r("span")]),r("div",{className:"flvjs",title:"1 kbps = 1000 bps"},[r("span",{className:"stats_name"},[r("text",ABP.Strings.statsVideoBitrate)]),r("span")]),r("div",{className:"flvjs",title:"1 kbps = 1000 bps"},[r("span",{className:"stats_name"},[r("text",ABP.Strings.statsAudioBitrate)]),r("span")]),r("div",{className:"flvjs",title:"1 kbps = 1000 bps"},[r("span",{className:"stats_name"},[r("text",ABP.Strings.statsCurrentBitrate)]),r("span")]),r("div",{title:"1 kbps = 1000 bps"},[r("span",{className:"stats_name"},[r("text",ABP.Strings.overallBitrate)]),r("span",{id:"overall-bitrate"})]),r("div",{className:"flvjs",title:"1 kbps = 1000 bps"},[r("span",{className:"stats_name"},[r("text",ABP.Strings.statsRealtimeBitrate)]),r("span",{className:"stats-column",id:"realtime-bitrate-column",style:{verticalAlign:"top"}}),r("span")]),r("div",{className:"flvjs"},[r("span",{className:"stats_name"},[r("text",ABP.Strings.statsDownloadSpeed)]),r("span",{className:"stats-column",id:"download-speed-column",style:{verticalAlign:"top"}}),r("span")]),r("br"),r("div",{id:"canvas-fps"},[r("span",{className:"stats_name"},[r("text","Canvas fps：")]),r("span")]),r("div",{className:"gecko"},[r("span",{className:"stats_name"},[r("text",ABP.Strings.statsMozParse)]),r("span",{id:"mozParsedFrames"})]),r("div",{className:"gecko"},[r("span",{className:"stats_name"},[r("text",ABP.Strings.statsMozDecode)]),r("span",{id:"mozDecodedFrames"})]),r("div",{className:"gecko"},[r("span",{className:"stats_name"},[r("text",ABP.Strings.statsMozPaint)]),r("span",{id:"mozPaintedFrames"})]),r("div",{className:"webkit"},[r("span",{className:"stats_name"},[r("text",ABP.Strings.statsWebkitDecode)]),r("span",{id:"webkitDecodedFrameCount"})]),r("div",{className:"webkit"},[r("span",{className:"stats_name"},[r("text",ABP.Strings.statsDrop)]),r("span",{id:"webkitDroppedFrameCount"})]),r("div",{className:"videoQuality"},[r("span",{className:"stats_name"},[r("text",ABP.Strings.statsPresent)]),r("span",{id:"totalVideoFrames"})]),r("div",{className:"videoQuality"},[r("span",{className:"stats_name"},[r("text",ABP.Strings.statsDrop)]),r("span",{id:"droppedVideoFrames"})]),r("br"),r("div",{style:{fontSize:"11px"}},[r("text",o)]),r("div",{style:{fontSize:"11px"}},[r("text","2017©esterTion")]),r("div",{id:"stats-close"},[r("text","×")])]),r("div",{className:"Drag-Control"},[r("div",{className:"Drag-Icon"}),r("div",{className:"Drag-Speed"},[r("text","")]),r("div",{className:"Drag-Time"},[r("text","00:00╱00:00")]),r("div",{className:"Drag-Time-Bar"},[r("div",{className:"fill"})])])]),r("div",{className:"ABP-Bottom"},[r("div",{className:"ABP-Bottom-Extend"}),r("div",{className:"BiliPlus-Scale-Menu"},[r("div",{className:"Video-Defination"}),r("div",{className:"Video-Scale"},[r("div",{changeTo:"default",className:"on"},[r("text",ABP.Strings.displayScaleD)]),r("div",{changeTo:"16_9"},[r("text","16:9")]),r("div",{changeTo:"4_3"},[r("text","4:3")]),r("div",{changeTo:"full"},[r("text",ABP.Strings.displayScaleF)])])]),r("div",{className:"ABP-Bottom-Wrapper"},[r("div",{className:"ABP-Text"},[r("div",{className:"ABP-CommentStyle"},[r("div",{className:"button-group ABP-Comment-FontGroup"},[r("div",{className:"button ABP-Comment-Font icon-font-style"}),r("div",{className:"ABP-Comment-FontOption"},[r("p",{className:"style-title"},[r("text",ABP.Strings.sendSize)]),r("div",{className:"style-select",name:"commentFontSize"},[r("div",{className:"style-option",value:18},[r("text",ABP.Strings.sendSmall)]),r("div",{className:"style-option on",value:25},[r("text",ABP.Strings.sendMid)])]),r("p",{className:"style-title"},[r("text",ABP.Strings.sendMode)]),r("div",{className:"style-select",name:"commentMode"},[r("div",{className:"style-option",value:5},[r("text",ABP.Strings.sendTop)]),r("div",{className:"style-option on",value:1},[r("text",ABP.Strings.sendScroll)]),r("div",{className:"style-option",value:4},[r("text",ABP.Strings.sendBottom)])])])]),r("div",{className:"button-group ABP-Comment-ColorGroup"},[r("div",{className:"ABP-Comment-Color-Display"}),r("div",{className:"button ABP-Comment-Color icon-color-mode"}),r("div",{className:"ABP-Comment-ColorOption"},[r("div",{className:"ABP-Comment-ColorPicker"})])])]),r("form",{style:{margin:0}},[r("input",{className:"ABP-Comment-Input"})]),r("div",{className:"ABP-Comment-Send"},[r("text",ABP.Strings.send)])]),r("div",{className:"ABP-Control"},[r("div",{className:"button ABP-Play icon-play"}),r("div",{className:"progress-bar"},[r("div",{className:"bar"},[r("div",{className:"load"}),r("div",{className:"dark"})])]),r("div",{className:"time-label"},[r("text","00:00 / 00:00")]),r("div",{className:"button ABP-Volume icon-volume-high"}),r("div",{className:"volume-bar"},[r("div",{className:"bar"},[r("div",{className:"load"})])]),r("div",{className:"button-group ABP-CommentGroup"},[r("div",{className:"button ABP-CommentShow icon-comment on"})]),r("div",{className:"button-group ABP-PlaySpeedGroup"},[r("div",{className:"button ABP-Loop icon-loop"})]),r("div",{className:"button ABP-Setting icon-gear"}),r("div",{className:"button ABP-WideScreen icon-tv"}),r("div",{className:"button-group ABP-FullScreenGroup"},[r("div",{className:"button ABP-FullScreen icon-screen-full"}),r("div",{className:"button ABP-Web-FullScreen icon-screen"})])])]),r("div",{className:"ABP-Title"})])])),n.appendChild(r("div",{className:"shield hidden"},[r("div",{className:"shield_top"},[r("text",ABP.Strings.commentBlock),r("span",{className:"close"})]),r("div",{className:"shield_tabs"},[r("div",{className:"shield_tab on"},[r("div",{},[r("text",ABP.Strings.shieldTypeText)])]),r("div",{className:"shield_tab"},[r("div",{},[r("text",ABP.Strings.shieldTypeUser)])]),r("div",{className:"shield_tab"},[r("div",{},[r("text",ABP.Strings.shieldTypeColor)])]),r("div",{className:"shield_tab"},[r("div",{},[r("text",ABP.Strings.shieldTypeSetting)])])]),r("div",{className:"shield_tab_slash"}),r("div",{className:"shield_body"},[r("div",{className:"shield_body_wrapper"},[r("div",{className:"shield_tab_body"},[r("div",{id:"shield_text"}),r("div",{className:"shield_item"},[r("input",{className:"new",type:"text",placeholder:ABP.Strings.shieldAdd}),r("div",{className:"add"})])]),r("div",{className:"shield_tab_body"},[r("div",{id:"shield_user"})]),r("div",{className:"shield_tab_body"},[r("div",{id:"shield_color"})]),r("div",{className:"shield_tab_body"},[r("div",{className:"shield_toggle",id:"useReg"},[r("text",ABP.Strings.shieldUseRegex)]),r("div",{className:"shield_toggle",id:"blockTop"},[r("text",ABP.Strings.shieldBlockTop)]),r("div",{className:"shield_toggle",id:"blockBottom"},[r("text",ABP.Strings.shieldBlockBottom)]),r("div",{className:"shield_toggle",id:"blockVisitor"},[r("text",ABP.Strings.shieldBlockVisitor)]),r("div",{className:"shield_slide",id:"repeat"},[r("div",{className:"fill"}),r("div",{className:"button"}),r("div",{className:"slide_info"})]),r("div",{style:{padding:"0 16px"}},[r("text",ABP.Strings.shieldRepeat)])])])])])),n.appendChild(r("div",{className:"ABP-Comment-List"},[r("div",{className:"ABP-Comment-List-Count"},[r("div",{style:{position:"absolute",right:"200px"}},[r("span",{id:"viewer",style:{fontWeight:"bold"}},[r("text","--")]),r("text",ABP.Strings.viewers)]),r("div",{style:{position:"absolute",right:"20px"}},[r("span",{id:"danmaku",style:{fontWeight:"bold"}},[r("text","--")]),r("text",ABP.Strings.comments)])]),r("div",{className:"ABP-Comment-List-Title"},[r("div",{className:"cmt-time",item:"time"},[r("text",ABP.Strings.commentTime)]),r("div",{className:"cmt-content",item:"content"},[r("text",ABP.Strings.commentContent)]),r("div",{className:"cmt-date",item:"date"},[r("text",ABP.Strings.commentDate)])]),r("div",{className:"ABP-Comment-List-Container"},[r("ul",{className:"ABP-Comment-List-Container-Inner"})])])),n.appendChild(r("div",{className:"ABP-Settings"},[r("div",{},[r("div",{className:"ABP-Settings-Top"},[r("div",{className:"ABP-Settings-Close"},[r("text","×")])]),r("div",{className:"ABP-Settings-Container"},[r("p",{className:"label big"},[r("text",ABP.Strings.settComment)]),r("p",{className:"label prop"},[r("text",ABP.Strings.useCSS),r("div",{className:"prop-checkbox"})]),r("p",{className:"label"},[r("text",ABP.Strings.commentSpeed)]),r("div",{className:"speed-bar"},[r("div",{className:"bar"},[r("div",{className:"load"})])]),r("p",{className:"label"},[r("text",ABP.Strings.commentScale)]),r("div",{className:"scale-bar"},[r("div",{className:"bar"},[r("div",{className:"load"})])]),r("p",{className:"label"},[r("text",ABP.Strings.commentOpacity),r("div",{className:"prop-checkbox",style:{top:"10px",left:"calc(100% - 20px)"}})]),r("div",{className:"opacity-bar",style:{width:"calc(100% - 25px)"}},[r("div",{className:"bar"},[r("div",{className:"load"})])]),r("div",{className:"shield-enrty"},[r("text",ABP.Strings.commentBlock)]),r("p",{className:"label big"},[r("text",ABP.Strings.playSpeed)]),r("div",{className:"playSpeed-bar"},[r("div",{className:"bar"},[r("div",{className:"load"})])]),r("div",{className:"play-speed-reset"},[r("text",ABP.Strings.playSpeedReset)]),r("p",{className:"label prop"},[r("text",ABP.Strings.recordPlaySpeed),r("div",{id:"setting-recordPlaySpeed",className:"prop-checkbox"})]),r("p",{className:"label big"},[r("text",ABP.Strings.settPlayer)]),r("p",{className:"label prop"},[r("text",ABP.Strings.autoPlay),r("div",{id:"setting-autoPlay",className:"prop-checkbox"})]),r("p",{className:"label prop"},[r("text",ABP.Strings.defaultWide),r("div",{id:"setting-defaultWide",className:"prop-checkbox"})]),r("p",{className:"label prop"},[r("text",ABP.Strings.defaultFull),r("div",{id:"setting-defaultFull",className:"prop-checkbox"})])])])])),n.appendChild(r("div",{className:"Context-Menu"},[r("div",{className:"Context-Menu-Background"}),r("div",{className:"Context-Menu-Body"},[r("div",{id:"Player-Stats-Toggle"},[r("text",ABP.Strings.showStats)]),r("div",{id:"Player-Speed-Control",className:"dm"},[r("div",{className:"content"},[r("text",ABP.Strings.playSpeed)]),r("div",{className:"dmMenu",style:{top:"-37px"}},[r("div",{"data-speed":.5},[r("text",.5)]),r("div",{"data-speed":1},[r("text",1)]),r("div",{"data-speed":1.25},[r("text",1.25)]),r("div",{"data-speed":1.5},[r("text",1.5)]),r("div",{"data-speed":2},[r("text",2)])])]),r("div",{className:"about"},[r("text",o)])])]));var f=ABP.bind(n);if(l.length>0){var g=l[0];f.gotoNext=function(){var e=l.indexOf(g)+1;if(e<l.length){g=l[e],g.style.display="";var t=f.video.parentNode;t.removeChild(f.video),t.appendChild(g),f.video.style.display="none",f.video=g,f.swapVideo(g),g[i]("ended",function(){f.gotoNext()})}},g[i]("ended",function(){f.gotoNext()})}return f};var S=function(){var e=3988292384,t=new Array(256),a=function(){var a,i,o;for(i=0;256>i;++i){for(a=i,o=0;8>o;++o)a=0!=(1&a)?e^a>>>1:a>>>1;t[i]=a}},i=function(e,a){for(var i,o=4294967295,n=e.length,l=0;n>l;++l)i=255&(o^e.charCodeAt(l)),o=o>>>8^t[i];return a?i:o},o=function(e){for(var a=0;256>a;a++)if(t[a]>>>24==e)return a;return-1},n="",l=function(e,a){var o=0,l="",s=i(e.toString(),!1);return o=255&s^a[2],57>=o&&o>=48?(l+=o-48,s=t[a[2]]^s>>>8,o=255&s^a[1],57>=o&&o>=48?(l+=o-48,s=t[a[1]]^s>>>8,o=255&s^a[0],57>=o&&o>=48?(l+=o-48,s=t[a[0]]^s>>>8,n=l,1):0):0):0};a();var s=new Array(4);return function(e){var a,r,c,d=4294967295^parseInt(e,16);for(r=1;1001>r;r++)if(d==i(r.toString(),!1))return r;for(r=3;r>=0;r--)s[3-r]=o(d>>>8*r),a=t[s[3-r]],d^=a>>>8*(3-r);for(r=0;1e5>r&&(c=i(r.toString(),!0),c!=s[3]||!l(r,s));r++);return 1e5==r?-1:r+""+n}},B=function(e){for(var t,a,i=0,o=e.currentTime;i<e.buffered.length;i++)if(o>=e.buffered.start(i)&&o<=e.buffered.end(i)){t=e.buffered.start(i),a=e.buffered.end(i);break}if(i==e.buffered.length)throw"Not in a range";return{start:t,end:a,delta:a-o,index:i}};window.crc_engine=new S,ABP.bind=function(o,n){var c={playerUnit:o,btnPlay:null,barTime:null,barLoad:null,barTimeHitArea:null,barVolume:null,barVolumeHitArea:null,barOpacity:null,barOpacityHitArea:null,barScale:null,barScaleHitArea:null,barSpeed:null,barSpeedHitArea:null,barPlaySpeed:null,barPlaySpeedHitArea:null,btnFont:null,btnColor:null,btnSend:null,controlBar:null,timeLabel:null,timeJump:null,divComment:null,btnWide:null,btnFull:null,btnWebFull:null,btnDm:null,btnLoop:null,btnProp:null,btnAutoOpacity:null,videoDiv:null,btnVolume:null,video:null,txtText:null,commentColor:"ffffff",commentFontSize:25,commentMode:1,displayColor:null,cmManager:null,commentList:null,commentListContainer:null,lastSelectedComment:null,commentCoolDown:1e4,commentScale:ABP.playerConfig.scale?ABP.playerConfig.scale:1,commentSpeed:ABP.playerConfig.speed?ABP.playerConfig.speed:1,proportionalScale:ABP.playerConfig.prop,autoPlay:!1,defaultWide:!1,defaultFull:!1,recordPlaySpeed:!1,defaults:{w:0,h:0},state:b(n,{fullscreen:!1,commentVisible:!0,allowRescale:!1,autosize:!1,widescreen:!1}),createPopup:function(e,a){if(o.hasPopup===!0)return!1;var i=r("div",{className:"ABP-Popup"},[r("text",e)]);return i.remove=function(){i.isRemoved||(i.isRemoved=!0,o.removeChild(i),o.hasPopup=!1)},o.appendChild(i),o.hasPopup=!0,"number"==typeof a&&t(function(){i.remove()},a),i},removePopup:function(){for(var e=o.getElementsByClassName("ABP-Popup"),t=0;t<e.length;t++)null!=e[t].remove?e[t].remove():e[t].parentNode.removeChild(e[t]);o.hasPopup=!1},loadCommentList:function(e,t){t="asc"==t?-1:1;var a=Object.keys(c.commentList).sort(function(a,i){return c.commentList[a][e]<c.commentList[i][e]?t:c.commentList[a][e]>c.commentList[i][e]?-t:0});c.commentObjArray=[];for(P in a){var o=a[P],n=c.commentList[o];if(n&&n.time){var l=r("li",{}),s=r("span",{className:"cmt-time"},[r("text",p(n.time/1e3))]),d=r("span",{className:"cmt-content"},[r("text",n.content)]),m=r("span",{className:"cmt-date"},[r("text",u(n.date,!0))]);f(d,!1,36),f(m,!1,18),d.tooltip(n.content),m.tooltip(u(n.date)),l.appendChild(s),l.appendChild(d),l.appendChild(m),l.data=n,l.originalData=danmaku,8==n.mode?l.style.background="#ffe100":0!=n.pool&&(l.style.background="#20ff20"),l[i]("dblclick",function(){c.video.currentTime=this.data.time/1e3,it(S.currentTime)}),c.commentObjArray.push(l)}}c.commentListContainer.style.height=24*c.commentObjArray.length+"px",c.renderCommentList(),c.playerUnit.querySelector(".ABP-Comment-List-Count span#danmaku").innerHTML=c.commentObjArray.length},renderCommentList:function(){var e=c.commentListContainer.parentElement.scrollTop,t=parseInt(e/24);c.commentListContainer.innerHTML="";for(var a=t;t+40>=a&&"undefined"!=typeof c.commentObjArray[a];a++){if(a==t&&a>0){var o=c.commentObjArray[a].cloneNode(!0),n=o.getElementsByClassName("cmt-content")[0],l=o.getElementsByClassName("cmt-date")[0];o[i]("dblclick",function(){c.video.currentTime=c.commentObjArray[a].data.time/1e3,it(S.currentTime)}),f(n,!1,36),f(l,!1,18),n.tooltip(c.commentObjArray[a].data.content),l.tooltip(u(c.commentObjArray[a].data.date)),o.style.paddingTop=24*t+"px"}else var o=c.commentObjArray[a];c.commentObjArray[a].childNodes[0].className=c.commentObjArray[a].data.originalData.isBlocked?"cmt-time blocked":"cmt-time",c.commentListContainer.appendChild(o)}},commentCallback:function(e){e.result?(c.commentList[e.id]=c.commentList[e.tmp_id],delete c.commentList[e.tmp_id]):(delete c.commentList[e.tmp_id],c.createPopup(e.error,5e3))},swapVideo:null};if(Object.defineProperty(c,"title",{get:function(){return c.playerUnit.getElementsByClassName("ABP-Title")[0].innerHTML},set:function(e){var t=c.playerUnit.getElementsByClassName("ABP-Title")[0];t.innerHTML="",t.appendChild(r("text",e))}}),c.swapVideo=function(e){var a=function(){if(!et){it(e.currentTime);try{var t=B(this),a=this.duration,i=t.end/a*100;c.barLoad.style.width=i+"%"}catch(e){return}}};e[i]("timeupdate",a);var n=0,l=!0,s=!1,r=!1,d=!1,m=function(){d=!1,e.removeEventListener("canplay",m),void 0!=c.lastTime&&(e.currentTime=c.lastTime,delete c.lastTime),void 0!=c.lastSpeed&&(e.playbackRate=c.lastSpeed,delete c.lastSpeed),!e.paused||!c.autoPlay&&l||c.btnPlay.click(),l&&(l=!1,c.state.widescreen||c.state.fullscreen||!c.defaultWide||c.btnWide.click(),!c.state.fullscreen&&c.defaultFull&&c.btnWebFull.click())},u=function(){var t=e.readyState,a=document.getElementById("ABP-info-box");if(!e.ended)switch(t){case 1:isMobile()&&e.paused&&(c.createPopup("请点击播放器开始播放",3e3),c.video.dispatchEvent(new Event("autoPlayFailed")));case 2:try{var i=e.buffered,o=B(e);if(flvplayer&&flvplayer._mediaDataSource&&o.delta<.2&&o.index<i.length-1)return console.warn("buffer gap at",i.end(o.index),", jump from",e.currentTime,"to",i.start(o.index+1)),void(e.currentTime=i.start(o.index+1))}catch(e){}0==a.style.opacity&&(a.style.opacity=1),dots.running||dots.runTimer();try{var o=B(e);a.childNodes[0].childNodes[0].innerHTML=ABP.Strings.buffering+" "+Math.floor(100*o.delta)/100+"s"}catch(e){a.childNodes[0].childNodes[0].innerHTML=ABP.Strings.buffering}break;case 3:case 4:1==a.style.opacity&&(a.style.opacity=0,dots.stopTimer())}},p=function(){if(window.cid&&!s&&!r&&!d){var t=JSON.parse(localStorage.playHistory||"{}");t[cid]=0|e.currentTime,localStorage.playHistory=JSON.stringify(t)}},v=function(){if(window.cid){var e=JSON.parse(localStorage.playHistory||"{}");e[cid]&&delete e[cid],localStorage.playHistory=JSON.stringify(e)}};e[i]("autoplay",function(){e[i]("canplay",m)}),e[i]("pause",p),e[i]("ended",function(){s=!0,v()});try{var f=JSON.parse(localStorage.playHistory||"{}");void 0!=f[cid]&&(c.lastTime=f[cid])}catch(e){}window[i]("beforeunload",function(){return p(),null}),c.playerUnit[i]("beforecidchange",function(){p(),d=!0,s=!1}),e[i]("loop",function(){r=e.loop}),e[i]("canplay",m),e[i]("canplay",u),e[i]("waiting",u),e[i]("readystatechange",u),e[i]("progress",u),e[i]("ended",function(){c.btnPlay.className="button ABP-Play icon-play",c.videoDiv.className="ABP-Video",window.parent!=window&&parent.h5NextPart&&parent.h5NextPart()}),e[i]("progress",a),e.isBound=!0;var h=0,b=!1;if(c.cmManager){c.cmManager[i]("load",function(){c.commentList={};for(P in c.cmManager.timeline){var e=c.cmManager.timeline[P];8!=e.mode||b||(b=!0,t(function(){var e=new CCLScripting("/js/CommentCoreLibraryScripting.min.js");c.cmManager.scripting=e.getSandbox(c.divComment,c.video)},0)),e.dbid&&e.stime&&(c.commentList[e.dbid]={date:e.date,time:e.stime,mode:e.mode,user:e.hash,pool:e.pool,content:e.text||e.code,originalData:e})}c.loadCommentList("date","asc"),c.commentListContainer.parentElement[i]("scroll",c.renderCommentList)}),c.cmManager.setBounds=function(){o.offsetHeight<=300||o.offsetWidth<=700?g(o,"ABP-Mini"):y(o,"ABP-Mini");{var e=c.videoDiv.offsetWidth,t=c.videoDiv.offsetHeight;c.proportionalScale?t/493*c.commentScale:c.commentScale}this.width=e,this.height=t,this.options.global.scale=this.width/680/c.commentSpeed,this.dispatchEvent("resize");for(var a in this.csa)this.csa[a].setBounds(this.width,this.height);this.stage.style.width=this.width+"px",this.stage.style.height=this.height+"px",this.stage.style.perspective=this.width*Math.tan(40*Math.PI/180)/2+"px",this.stage.style.webkitPerspective=this.width*Math.tan(40*Math.PI/180)/2+"px",o.querySelector(".BiliPlus-Scale-Menu .Video-Scale div.on").click(),this.canvasResize()},c.cmManager.setBounds(),c.cmManager.clear(),e[i]("progress",function(){h==e.currentTime&&S&&(new Date).getTime()-n>=100?(e.hasStalled=!0,c.cmManager.stopTimer(),c.cmManager.pauseComment()):h!=e.currentTime&&(h=e.currentTime),n=(new Date).getTime()}),window&&window[i]("resize",function(){c.cmManager.setBounds()}),e[i]("timeupdate",function(){c.cmManager.display!==!1&&(e.hasStalled&&(c.cmManager.startTimer(),c.cmManager.resumeComment(),e.hasStalled=!1),c.cmManager.time(Math.floor(1e3*e.currentTime)))}),e[i]("play",function(){c.cmManager.startTimer(),c.cmManager.resumeComment(),c.btnPlay.className="button ABP-Play ABP-Pause icon-pause",c.btnPlay.tooltip(ABP.Strings.pause),g(c.videoDiv,"ABP-HideCursor")}),e[i]("ratechange",function(){0!==e.playbackRate&&(c.recordPlaySpeed&&Ze(),pt(c.video.playbackRate))});var S=!1;e[i]("pause",function(){c.cmManager.stopTimer(),c.cmManager.pauseComment(),c.btnPlay.className="button ABP-Play icon-play",c.btnPlay.tooltip(ABP.Strings.play),S=!1,y(c.videoDiv,"ABP-HideCursor")}),e[i]("waiting",function(){c.cmManager.stopTimer(),c.cmManager.pauseComment(),S=!1}),e[i]("playing",function(){c.cmManager.startTimer(),c.cmManager.resumeComment(),S=!0})}},null!==o&&null!==o.getElementsByClassName){c.defaults.w=o.offsetWidth,c.defaults.h=o.offsetHeight;var m=o.getElementsByClassName("ABP-Video");if(!(m.length<=0)){var S=null;c.videoDiv=m[0];for(var P in m[0].children)if(null!=m[0].children[P].tagName&&"VIDEO"===m[0].children[P].tagName.toUpperCase()){S=m[0].children[P];break}var C=m[0].getElementsByClassName("ABP-Container");

if(C.length>0&&(c.divComment=C[0]),null!==S){c.video=S,c.video.seek=function(e){this.currentTime=parseFloat(e)/1e3};var k=o.getElementsByClassName("ABP-Play");if(!(k.length<=0)){c.btnPlay=k[0],c.btnPlay.tooltip(ABP.Strings.play),f(c.btnPlay);var A=o.getElementsByClassName("progress-bar");if(!(A.length<=0)){var N=A[0].getElementsByClassName("bar");c.barTimeHitArea=N[0],c.barLoad=N[0].getElementsByClassName("load")[0],c.barTime=N[0].getElementsByClassName("dark")[0];var x=o.getElementsByClassName("time-label");if(!(x.length<=0)){c.timeLabel=x[0];var w=o.getElementsByClassName("ABP-Volume");if(!(w.length<=0)){c.btnVolume=w[0],c.btnVolume.tooltip(ABP.Strings.mute),f(c.btnVolume);var _=o.getElementsByClassName("volume-bar");if(!(_.length<=0)){var M=_[0].getElementsByClassName("bar");c.barVolumeHitArea=M[0],c.barVolume=M[0].getElementsByClassName("load")[0];var T=o.getElementsByClassName("opacity-bar");if(!(T.length<=0)){var T=T[0].getElementsByClassName("bar");c.barOpacityHitArea=T[0],c.barOpacity=T[0].getElementsByClassName("load")[0];var H=o.getElementsByClassName("scale-bar");if(!(H.length<=0)){var H=H[0].getElementsByClassName("bar");c.barScaleHitArea=H[0],c.barScale=H[0].getElementsByClassName("load")[0];var L=o.getElementsByClassName("speed-bar");if(!(L.length<=0)){var L=L[0].getElementsByClassName("bar");c.barSpeedHitArea=L[0],c.barSpeed=L[0].getElementsByClassName("load")[0];var F=o.getElementsByClassName("playSpeed-bar");if(!(F.length<=0)){var F=F[0].getElementsByClassName("bar");c.barPlaySpeedHitArea=F[0],c.barPlaySpeed=F[0].getElementsByClassName("load")[0],o.querySelector(".play-speed-reset")[i]("click",function(){c.video.playbackRate=1});var D=o.getElementsByClassName("prop-checkbox");if(!(D.length<=0)){c.btnAutoOpacity=D[1],c.btnAutoOpacity.tooltip(ABP.Strings.autoOpacityOff),f(c.btnAutoOpacity),c.btnProp=D[0],c.btnProp.tooltip(ABP.Strings.usingCanvas),f(c.btnProp);var E=o.getElementsByClassName("ABP-FullScreen");if(!(E.length<=0)){c.btnFull=E[0],c.btnFull.tooltip(ABP.Strings.fullScreen),f(c.btnFull);var I=o.getElementsByClassName("ABP-Web-FullScreen");if(!(I.length<=0)){c.btnWebFull=I[0],c.btnWebFull.tooltip(ABP.Strings.webFull),f(c.btnWebFull);var O=o.getElementsByClassName("ABP-WideScreen");if(!(O.length<=0)){c.btnWide=O[0],c.btnWide.tooltip(ABP.Strings.wideScreen),f(c.btnWide);var W=o.getElementsByClassName("ABP-Comment-Font");if(!(W.length<=0)){c.btnFont=W[0],c.btnFont.tooltip(ABP.Strings.sendStyle),f(c.btnFont);var z=o.getElementsByClassName("ABP-Comment-Color");if(!(z.length<=0)){c.btnColor=z[0],c.btnColor.tooltip(ABP.Strings.sendColor),f(c.btnColor);var R=o.getElementsByClassName("ABP-Comment-Color-Display");if(!(R.length<=0)){c.displayColor=R[0];var V=o.getElementsByClassName("ABP-Comment-Input");if(!(V.length<=0)){c.txtText=V[0];var q=o.getElementsByClassName("ABP-Comment-List-Container-Inner");if(!(q.length<=0)){c.commentListContainer=q[0];var j=o.getElementsByClassName("ABP-Comment-Send");if(!(j.length<=0)){c.btnSend=j[0],c.btnSend.tooltip(ABP.Strings.sendTooltip),f(c.btnSend);var U=o.getElementsByClassName("ABP-Control");U.length>0&&(c.controlBar=U[0]);var X=o.getElementsByClassName("ABP-CommentShow");if(!(X.length<=0)){c.btnDm=X[0],c.btnDm.tooltip(ABP.Strings.hideComment),f(c.btnDm);var J=o.getElementsByClassName("ABP-Loop");if(!(J.length<=0)){c.btnLoop=J[0],c.btnLoop.tooltip(ABP.Strings.loopOff),f(c.btnLoop);var Y=o.getElementsByClassName("ABP-Setting")[0],Q=o.getElementsByClassName("ABP-Settings")[0];c.btnSetting=Y,c.settingPanel=Q,c.btnSetting.tooltip(ABP.Strings.settings),f(c.btnSetting);var G=!1,K=function(){G?y(Q,"expand"):g(Q,"expand"),G?y(Y,"on"):g(Y,"on"),G=!G};c.btnSetting.addEventListener("click",K),o.getElementsByClassName("ABP-Settings-Close")[0].addEventListener("click",K),document.getElementById("setting-autoPlay").addEventListener("click",function(){c.autoPlay=!c.autoPlay,c.autoPlay?g(this,"on"):y(this,"on"),Ze()}),document.getElementById("setting-defaultWide").addEventListener("click",function(){c.defaultWide=!c.defaultWide,c.defaultWide?g(this,"on"):y(this,"on"),Ze()}),document.getElementById("setting-defaultFull").addEventListener("click",function(){c.defaultFull=!c.defaultFull,c.defaultFull?g(this,"on"):y(this,"on"),Ze()}),document.getElementById("setting-recordPlaySpeed").addEventListener("click",function(){c.recordPlaySpeed=!c.recordPlaySpeed,c.recordPlaySpeed?g(this,"on"):y(this,"on"),Ze()});var Z={videoDimension:!0,gecko:!0,webkit:!0,videoQuality:!0,flvjs:!0},$=function(e){return document.querySelector(e)},ee=function(e){return document.getElementById(e)},te=function(e){return(1*e).toFixed(2)},ae=ee("player-dimension").lastChild,ie=ee("video-dimension").lastChild,oe=ee("canvas-fps").lastChild,ne=ee("buffer-health-column"),le=ee("realtime-bitrate-column"),se=ee("download-speed-column"),re=[],ce=[],de=[],me=ee("buffer-health").lastChild,ue='<svg style="width:180px;height:21px"><polyline style="fill:transparent;stroke:#ccc"></polyline><polyline points="1,21 180,21 180,1" style="fill:transparent;stroke:#fff"></polyline></svg>',pe="",ve=r("style"),fe=r("style"),ge=document.querySelectorAll(".flvjs>:last-child"),P=0,he=function(e,t){var a,i=0,o=[];t.forEach(function(e){i=e>i?e:i}),0==i&&(i=1);for(a in t)o.push(3*a+","+(20*(1-t[a]/i)+1)+" "+(3*a+3)+","+(20*(1-t[a]/i)+1));e.setAttribute("points",o.join(" "))},ye=!1,be=ee("Player-Stats-Toggle"),Se=function(e){"stats-close"==e.target.id&&e.stopPropagation(),$(".Player-Stats").style.display=ye?"":"block",ye=!ye},Be=-1,Pe=0;for(be[i]("click",Se),ee("stats-close")[i]("click",Se);60>P;P++)re.push(0),ce.push(0),de.push(0);if(ne.innerHTML=ue,ne=ne.firstChild.firstChild,le.innerHTML=ue,le=le.firstChild.firstChild,se.innerHTML=ue,se=se.firstChild.firstChild,void 0==S.videoWidth&&(Z.videoDimension=!1,pe+="#video-dimension{display:none}"),void 0==S.mozDecodedFrames&&(Z.gecko=!1,pe+=".gecko{display:none}"),void 0==S.webkitDecodedFrameCount&&(Z.webkit=!1,pe+=".webkit{display:none}"),void 0==S.getVideoPlaybackQuality&&(Z.videoQuality=!1,pe+=".videoQuality{display:none}"),ve.innerHTML=pe,document.head.appendChild(ve),fe.innerHTML=".flvjs{display:none}",document.head.appendChild(fe),void 0==window.flvplayer&&(Z.flvjs=!1),setInterval(function(){Pe^=1,ae.innerHTML=S.offsetWidth+"x"+S.offsetHeight+" *"+devicePixelRatio,Z.videoDimension&&(ie.innerHTML=S.videoWidth+"x"+S.videoHeight);var e={};try{e=B(S)}catch(e){}if(e=e.delta||0,re.push(e),re.shift(),me.innerHTML=te(e)+"s",ye&&he(ne,re),ye){for(var t,a,i=S.buffered,o=$("#buffer-clips>span"),n=S.duration==1/0?i.end(i.length-1):S.duration,l=[],s=0;s<i.length;s++)s>=o.childNodes.length&&o.appendChild(r("span",{className:"buffer-clip"})),t=i.start(s),a=i.end(s)-t,o.childNodes[s].style.left=te(t/n*100)+"%",o.childNodes[s].style.width=te(a/n*100)+"%",l.push(p(0|t)+" - "+p(t+a|0));for(;s<o.childNodes.length;)o.childNodes[s].remove();o.parentNode.parentNode.childNodes[2].innerHTML=l.join("\n"),$("#buffer-clips>span>div").style.left=te(S.currentTime/n*100)+"%"}if(Z.flvjs)if(flvplayer._mediaInfo){fe.innerHTML="";var d,m,s=0,u=flvplayer._mediaInfo,v=flvplayer.statisticsInfo,f=S.currentTime,g=flvplayer._mediaDataSource.segments,h=0,y=0;for(m=0;m<g.length;m++){if(f<=(h+g[m].duration)/1e3){h=f-h/1e3|0;break}h+=g[m].duration,y++}var b=g[m].filesize,P=g[m].duration;ee("mimeType").lastChild.innerHTML=u.mimeType,ge[s++].innerHTML=te(u.fps),ge[s++].innerHTML=te(u.videoDataRate)+" kbps",ge[s++].innerHTML=te(u.audioDataRate)+" kbps",ge[s++].innerHTML=te(b/P*8)+" kbps",u.bitrateMap?(u.bitrateMap[y]&&(d=u.bitrateMap[y][h]),void 0!=d?Pe&&Be!=(0|S.currentTime)?(Be=0|S.currentTime,ge[s++].innerHTML=te(d)+" kbps",ce.push(d),ce.shift(),ye&&he(le,ce)):s++:ge[s++].innerHTML="N/A"):ge[s++].innerHTML="N/A",Pe&&(de.push(v.speed),de.shift(),ye&&he(se,de),ge[s++].innerHTML=te(v.speed)+" KB/s",flvplayer._statisticsInfo.speed=0)}else fe.innerHTML=".flvjs{display:none}",ee("mimeType").lastChild.innerHTML="video/mp4";if(window.overallBitrate?(ee("overall-bitrate").parentNode.style.display="",ee("overall-bitrate").innerHTML=te(overallBitrate)+" kbps"):ee("overall-bitrate").parentNode.style.display="none",Pe&&(oe.innerHTML=c.cmManager.canvasFPS),Z.gecko&&["mozParsedFrames","mozDecodedFrames","mozPaintedFrames"].forEach(function(e){ee(e).innerHTML=S[e]}),Z.webkit&&["webkitDecodedFrameCount","webkitDroppedFrameCount"].forEach(function(e){ee(e).innerHTML=S[e]}),Z.videoQuality){var C=S.getVideoPlaybackQuality();ee("totalVideoFrames").innerHTML=C.totalVideoFrames,ee("droppedVideoFrames").innerHTML=C.droppedVideoFrames}},500),"undefined"!=typeof CommentManager&&(c.cmManager=new CommentManager(c.divComment),c.cmManager.display=!0,c.cmManager.init(),c.cmManager.clear(),c.cmManager.filter.addModifier(shield.filter),window&&window[i]("resize",function(){c.cmManager.setBounds()})),"object"==typeof ABP.playerConfig&&(ABP.playerConfig.volume&&(c.video.volume=ABP.playerConfig.volume),ABP.playerConfig.opacity&&(c.cmManager.options.global.opacity=ABP.playerConfig.opacity),ABP.playerConfig.autoPlay&&(c.autoPlay=!0,g(document.getElementById("setting-autoPlay"),"on")),ABP.playerConfig.defaultWide&&(c.defaultWide=!0,g(document.getElementById("setting-defaultWide"),"on")),ABP.playerConfig.defaultFull&&(c.defaultFull=!0,g(document.getElementById("setting-defaultFull"),"on")),ABP.playerConfig.recordPlaySpeed&&(c.recordPlaySpeed=!0,g(document.getElementById("setting-recordPlaySpeed"),"on"),c.lastSpeed=ABP.playerConfig.playSpeed,console.log(c.lastSpeed))),e(".ABP-Comment-List-Title *").click(function(){var t=e(this).attr("item"),a=e(this).hasClass("asc")?"desc":"asc";e(".ABP-Comment-List-Title *").removeClass("asc").removeClass("desc"),e(this).addClass(a),c.loadCommentList(t,a)}),e(".ABP-Unit .ABP-CommentStyle .ABP-Comment-FontOption .style-option").click(function(){e(this).closest(".style-select").find(".style-option").removeClass("on"),e(this).addClass("on"),c[e(this).closest(".style-select").attr("name")]=parseInt(e(this).attr("value"))}),e(o).find(".ABP-Comment-ColorPicker").colpick({flat:!0,submit:0,color:"ffffff",onChange:function(e,t){c.commentColor=t,c.displayColor.style.backgroundColor="#"+t}}),S.isBound!==!0){c.swapVideo(S),c.playerUnit.querySelector(".BiliPlus-Scale-Menu .Video-Defination")[i]("click",function(e){if(!e.target.hasAttribute("changeto"))return!1;var t=JSON.parse(e.target.getAttribute("changeto"));changeSrc({target:{value:t[1]}},t[0]),y(e.target.parentNode.querySelector(".on"),"on"),g(e.target,"on")}),c.playerUnit.querySelector(".BiliPlus-Scale-Menu .Video-Scale")[i]("click",function(e){if(!e.target.hasAttribute("changeto"))return!1;switch(e.target.getAttribute("changeto")){case"default":h(c.video,"scale")&&y(c.video,"scale"),c.video.style.width="",c.video.style.height="",c.video.style.paddingTop="",c.video.style.paddingLeft="";break;case"16_9":g(c.video,"scale");var t=c.videoDiv.offsetWidth,a=c.videoDiv.offsetHeight,i="",o="";a/9*16>t?(i=(a-t/16*9)/2+"px",a=t/16*9/a*100+"%",t="100%"):(o=(t-a/9*16)/2+"px",t=a/9*16/t*100+"%",a="100%"),c.video.style.width=t,c.video.style.height=a,c.video.style.paddingTop=i,c.video.style.paddingLeft=o;break;case"4_3":g(c.video,"scale");var t=c.videoDiv.offsetWidth,a=c.videoDiv.offsetHeight,i="",o="";a/3*4>t?(i=(a-t/4*3)/2+"px",a=t/4*3/a*100+"%",t="100%"):(o=(t-a/3*4)/2+"px",t=a/3*4/t*100+"%",a="100%"),c.video.style.width=t,c.video.style.height=a,c.video.style.paddingTop=i,c.video.style.paddingLeft=o;break;case"full":g(c.video,"scale"),c.video.style.width="",c.video.style.height="",c.video.style.paddingTop="",c.video.style.paddingLeft=""}y(e.target.parentNode.querySelector(".on"),"on"),g(e.target,"on")});var Ce=!1;S[i]("autoPlayFailed",function(){Ce=!0});var ke,Ae=0,Ne=function(e){var i=Date.now();500>=i-Ae?(c.btnFull.click(),200>=i-Ae?a(ke):c.btnPlay.click()):Ce?(c.btnPlay.click(),Ce=!1):ke=t(function(){c.btnPlay.click()},250),Ae=i,e.preventDefault()};c.videoDiv[i]("click",Ne),c.playerUnit.querySelector(".ABP-Bottom-Extend")[i]("click",function(e){e.preventDefault(),e.stopPropagation(),Ne(e)});var xe=t(function(){g(c.videoDiv,"ABP-HideCursor")},3e3);c.videoDiv[i]("mousemove",function(e){l(e)&&(xe&&a(xe),h(c.videoDiv,"ABP-HideCursor")&&y(c.videoDiv,"ABP-HideCursor"),xe=t(function(){g(c.videoDiv,"ABP-HideCursor")},3e3))}),c.btnVolume[i]("click",function(){if(0==c.video.muted){if(c.video.muted=!0,0==c.video.muted)return void this.tooltip(ABP.Strings.muteNotSupported);this.className="button ABP-Volume icon-volume-mute2",this.tooltip(ABP.Strings.unmute),c.barVolume.style.width="0%"}else c.video.muted=!1,this.className="button ABP-Volume icon-volume-",this.className+=c.video.volume<.1?"mute":c.video.volume<.33?"low":c.video.volume<.67?"medium":"high",this.tooltip(ABP.Strings.mute),c.barVolume.style.width=100*c.video.volume+"%"}),c.btnWebFull[i]("click",function(){c.state.fullscreen=h(o,"ABP-FullScreen"),g(o,"ABP-FullScreen"),c.btnFull.className="button ABP-FullScreen icon-screen-normal",c.btnFull.tooltip(ABP.Strings.exitWebFull),c.state.fullscreen=!0,c.cmManager&&c.cmManager.setBounds(),c.state.allowRescale&&(c.state.fullscreen?c.defaults.w>0&&(c.cmManager.options.scrollScale=o.offsetWidth/c.defaults.w):c.cmManager.options.scrollScale=1)});var we=!1,_e=!1;c.btnFont[i]("click",function(){_e&&c.btnColor.click(),this.parentNode.classList.toggle("on"),we=!we}),c.btnColor[i]("click",function(){we&&c.btnFont.click(),this.parentNode.classList.toggle("on"),_e=!_e}),c.btnAutoOpacity[i]("click",function(){this.classList.toggle("on");var e=this.classList.contains("on");c.cmManager.autoOpacity(e),this.tooltip(e?ABP.Strings.autoOpacityOn:ABP.Strings.autoOpacityOff),Ze()}),c.btnProp[i]("click",function(){this.classList.toggle("on");var e=this.classList.contains("on");c.cmManager.useCSS(e),this.tooltip(e?ABP.Strings.usingCSS:ABP.Strings.usingCanvas),Ze()});var Me=function(){!document.isFullScreen()&&h(o,"ABP-FullScreen")&&(y(o,"ABP-FullScreen"),c.btnFull.className="button ABP-FullScreen icon-screen-full",c.btnFull.tooltip(ABP.Strings.fullScreen),c.state.fullscreen=!!document.isFullScreen())};document[i]("fullscreenchange",Me,!1),document[i]("webkitfullscreenchange",Me,!1),document[i]("mozfullscreenchange",Me,!1),document[i]("MSFullscreenChange",Me,!1),c.btnFull[i]("click",function(){c.state.fullscreen=h(o,"ABP-FullScreen"),c.state.fullscreen?(y(o,"ABP-FullScreen"),this.className="button ABP-FullScreen icon-screen-full",this.tooltip(ABP.Strings.fullScreen),document.exitFullscreen()):(g(o,"ABP-FullScreen"),this.className="button ABP-FullScreen icon-screen-normal",this.tooltip(ABP.Strings.exitFullScreen),o.requestFullScreen()),c.state.fullscreen=!c.state.fullscreen,c.cmManager&&c.cmManager.setBounds(),c.state.allowRescale&&(c.state.fullscreen?c.defaults.w>0&&(c.cmManager.options.scrollScale=o.offsetWidth/c.defaults.w):c.cmManager.options.scrollScale=1)}),c.btnWide[i]("click",function(){c.state.widescreen=h(o,"ABP-WideScreen"),c.state.widescreen?(y(o,"ABP-WideScreen"),this.className="button ABP-WideScreen icon-tv",o.dispatchEvent(new Event("normal")),this.tooltip(ABP.Strings.wideScreen)):(g(o,"ABP-WideScreen"),this.className="button ABP-WideScreen icon-tv on",o.dispatchEvent(new Event("wide")),this.tooltip(ABP.Strings.exitWideScreen)),c.state.widescreen=!c.state.widescreen,c.cmManager&&c.cmManager.setBounds(),c.state.allowRescale&&(c.state.fullscreen?c.defaults.w>0&&(c.cmManager.options.scrollScale=o.offsetWidth/c.defaults.w):c.cmManager.options.scrollScale=1)}),c.btnDm[i]("click",function(){0==c.cmManager.display?(c.cmManager.display=!0,c.cmManager.startTimer(),this.className="button ABP-CommentShow icon-comment on",this.tooltip(ABP.Strings.hideComment)):(c.cmManager.display=!1,c.cmManager.clear(),c.cmManager.stopTimer(),this.className="button ABP-CommentShow icon-comment",this.tooltip(ABP.Strings.showComment)),Ze()}),c.btnLoop[i]("click",function(){0==c.video.loop?(c.video.loop=!0,this.className="button ABP-Loop icon-loop on",this.tooltip(ABP.Strings.loopOn)):(c.video.loop=!1,this.className="button ABP-Loop icon-loop",this.tooltip(ABP.Strings.loopOff)),c.video.dispatchEvent(new CustomEvent("loop"))});var Te,He,Le,Fe=c.playerUnit.querySelector(".Context-Menu"),De=Fe.querySelector(".Context-Menu-Background"),Ee=Fe.querySelector(".Context-Menu-Body"),Ie=function(e){return Je?(e.preventDefault(),e.stopPropagation(),Je=!1,!1):(Fe.style.display="none",void e.preventDefault())},Oe=function(e){for(var t=0,a=-1,t=0,i=c.commentObjArray.length;i>t;t++)if(c.commentObjArray[t].data.originalData.dbid==e){a=t;break}-1!=a&&(c.state.fullscreen&&c.btnFull.click(),c.state.widescreen&&c.btnWide.click(),c.commentListContainer.parentNode.scrollTop=24*a)},We=null,ze=null,Re=0,Ve=null,qe={},je=function(){if(0!=Re){if(void 0!=qe[Re])return void Ee.dispatchEvent(new CustomEvent("senderInfoFetched",{detail:qe[Re]}));var e=r("script",{className:"info_jsonp",src:"//account.bilibili.com/api/member/getCardByMid?type=jsonp&callback=getSenderInfo&mid="+Re});document.body.appendChild(e)}},Ue=function(e,o,n){Fe.style.display="block";var l,s,d,m,u,p=Ee.getElementsByClassName("dm"),v=c.playerUnit.getBoundingClientRect();for(P=p.length-2;P>=0;P--)p[P].remove();for(l=Ee.firstChild,P=0;P<n.length;P++){for(s=n[P].originalData,d=s.color.toString(16);d.length<6;)d="0"+d;if(m=16777215==s.color,u=r("div",{className:"dm"},[r("div",{className:"content"},[r("text",s.text)]),r("div",{className:"dmMenu"},[r("div",{"data-content":s.text},[r("text",ABP.Strings.copyComment)]),r("div",{"data-dmid":s.dbid},[r("text",ABP.Strings.findComment)]),r("div",{onclick:'shield.addText("'+s.text+'")'},[r("text",ABP.Strings.blockContent+"“"+s.text+"”")]),r("div",{"data-mid":crc_engine(s.hash),onclick:'shield.addUser("'+s.hash+'")'},[r("text",ABP.Strings.blockUser+""+s.hash+"(mid:"+crc_engine(s.hash)+")")]),r("div",m?{}:{onclick:'shield.addColor("'+d+'")'},[r("text",m?ABP.Strings.blockColorWhite:ABP.Strings.blockColor+""),r("div",{className:"color",style:{background:"#"+d}})])])]),s.mode>6){u.childNodes[0].innerHTML="特殊弹幕";var f=u.childNodes[1];f.childNodes[0].style.display="none",f.childNodes[2].style.display="none",f.childNodes[4].style.display="none"}Ee.insertBefore(u,l)}var g=Ee.getElementsByClassName("dmMenu");for(P=0;P<g.length-1;P++)g[P].childNodes[0][i]("click",function(){try{var e=document.createElement("input");e.style.width=0,e.style.height=0,document.body.appendChild(e),e.value=this.getAttribute("data-content"),e.select();var t=document.execCommand("copy");if(document.body.removeChild(e),!t)throw""}catch(e){c.createPopup(ABP.Strings.copyFail,3e3)}}),g[P].childNodes[1][i]("click",function(){Oe(this.getAttribute("data-dmid"))}),g[P].childNodes[3][i]("mouseenter",function(){Re=this.getAttribute("data-mid"),Ve=this,We=t(je,500)}),g[P].childNodes[3][i]("mouseleave",function(){a(We),Re=0,Ve=null,null!=document.getElementById("Sender-Info")&&(a(ze),ze=t(function(){document.body.removeChild(document.getElementById("Sender-Info"))},500))});e-=v.left,o-=v.top,v.width-e<300&&(e=v.width-300),v.height-Ee.offsetHeight-o<0&&(o=v.height-Ee.offsetHeight);var h=Ee.querySelector(".dm:nth-last-of-type(2)>.dmMenu");if(null!=h){h.style.display="block";var y=h.getBoundingClientRect();h.style.display="",v.top+v.height-y.height-o<0&&(o=v.height-y.height)}Ee.style.left=e+"px",Ee.style.top=o+"px"},Xe=null,Je=!1,Ye=!1,Qe=!1,Ge=!1,Ke=null;Ee.querySelector("#Player-Speed-Control .dmMenu")[i]("click",function(e){var t=e.target.getAttribute("data-speed");void 0!=t&&(c.video.playbackRate=t)}),Ee[i]("senderInfoFetched",function(e){var o=e.detail;if(o.mid==Re&&null!=Ve){var n=Ve.parentNode.getBoundingClientRect(),l=n.left-150,s=innerHeight-n.bottom,c=r("div",{className:"Context-Menu-Body",id:"Sender-Info",style:{left:l+"px",bottom:s+"px",position:"fixed",fontFamily:"-apple-system,Arial,'PingFang SC','STHeiti Light','Hiragino Kaku Gothic ProN','Microsoft YaHei'",textAlign:"center"}},[r("div",{},[r("img",{style:{height:"130px",width:"130px"},src:o.face.replace(/http\:/,"")})]),r("div",{},[r("text",o.name)]),r("div",{},[r("text",o.mid)]),r("div",{},[r("text","LV"+o.level_info.current_level)])]);document.body.appendChild(c),s+c.offsetHeight>innerHeight&&(c.style.bottom="",c.style.top=n.top+"px"),c[i]("click",function(){window.open("/space/"+o.mid+"/"),document.body.removeChild(c)}),c[i]("mouseenter",function(){a(ze)}),c[i]("mouseleave",function(){a(ze),ze=t(function(){document.body.removeChild(document.getElementById("Sender-Info"))},500)})}}),window.getSenderInfo=function(e){0==e.code&&(qe[Re]=e.card,Ee.dispatchEvent(new CustomEvent("senderInfoFetched",{detail:e.card})))},Fe[i]("click",Ie),De[i]("contextmenu",Ie),c.videoDiv.parentNode[i]("contextmenu",function(e){e.preventDefault(),e.stopPropagation();var t=c.divComment.getBoundingClientRect(),a=e.clientX,i=e.clientY;Ue(a,i,c.cmManager.getCommentFromPoint(a-t.left,i-t.top))}),c.commentListContainer[i]("contextmenu",function(e){var t=e.target.parentNode.data;return void 0==t?!1:(e.preventDefault(),e.stopPropagation(),void Ue(e.clientX,e.clientY,[t]))}),c.videoDiv.parentNode[i]("touchstart",function(e){if(Ye=!1,Qe=!1,Le=c.video.currentTime,Je=!1,e.touches.length>1&&null!=Xe)return a(Xe),void(Xe=null);var i=c.divComment.getBoundingClientRect(),o=e.touches[0].clientX,n=e.touches[0].clientY,l=c.cmManager.getCommentFromPoint(o-i.left,n-i.top);Te=o,He=n,Xe=t(function(){Qe=!0,Xe=null,Je=!0,Ue(o,n,l)},300)}),c.playerUnit.querySelector(".shield").addEventListener("touchstart touchmove touchend",function(e){e.stopPropagation()}),c.videoDiv.parentNode[i]("touchmove",function(e){null!=Xe&&(a(Xe),Xe=null);var t=e.touches[0].clientX,i=e.touches[0].clientY,o=t-Te,n=i-He,l=c.videoDiv.getBoundingClientRect(),s=(l.width,l.height);if(Ye){var r=0,d=o>0?1:0,m=["Low","Med","High"],u=c.video.duration;s/3>i?Le+=.2*o:2*s/3>i?(Le+=.6*o,r=1):(Le+=1.5*o,r=2),Le=0>Le?0:Le>u?u:Le,Te+=o,Te-l.left<50||l.right-Te<50?(document.querySelector(".Drag-Icon").className="Drag-Icon cancel",$(".Drag-Speed").innerHTML=ABP.Strings.dragControlCancel,$(".Drag-Time").innerHTML="　",Ge=!0):(document.querySelector(".Drag-Icon").className="Drag-Icon "+(d?"forward":"rewind"),$(".Drag-Speed").innerHTML=ABP.Strings["dragControl"+m[r]+(d?"Inc":"Dec")],$(".Drag-Time").innerHTML=p(Le)+"╱"+p(u),Ge=!1,u>0&&(document.querySelector(".Drag-Time-Bar .fill").style.width=Le/u*100+"%"))}else Qe||(-10>o||o>10?(Ye=!0,null!=Ke&&(a(Ke),Ke=null),$(".Drag-Control").style.display="block"):(-10>n||n>10)&&(Qe=!0))}),c.videoDiv.parentNode[i]("touchend",function(){null!=Xe&&(a(Xe),Xe=null),Ye&&!Ge&&(c.video.currentTime=Le),Ke=t(function(){$(".Drag-Control").style.display="none"},1e3)}),Ee[i]("touchstart",function(e){var t=Ee.getBoundingClientRect();e.touches[0].clientX-t.left<=t.width&&e.touches[0].clientY-t.top<=t.height&&(Je=!0)});var Ze=function(){localStorage.html5Settings=JSON.stringify({volume:c.video.volume,opacity:c.cmManager.options.global.opacity,scale:c.commentScale,speed:c.commentSpeed,commentVisible:c.cmManager.display,autoOpacity:c.cmManager.options.global.autoOpacity,useCSS:c.cmManager.options.global.useCSS,autoPlay:c.autoPlay,defaultWide:c.defaultWide,defaultFull:c.defaultFull,playSpeed:c.video.playbackRate,recordPlaySpeed:c.recordPlaySpeed})},$e=function(){var e=new Date,a=""+e.getTime()+Math.random();return""==c.txtText.value||c.txtText.disabled?!1:(c.playerUnit.dispatchEvent(new CustomEvent("sendcomment",{detail:{id:a,message:c.txtText.value,fontsize:c.commentFontSize,color:parseInt("0x"+c.commentColor),date:e.getFullYear()+"-"+d(e.getMonth())+"-"+d(e.getDay())+" "+d(e.getHours())+":"+d(e.getMinutes())+":"+d(e.getSeconds()),playTime:c.video.currentTime,mode:c.commentMode,pool:0}})),c.cmManager.send({text:c.txtText.value,mode:c.commentMode,stime:c.video.currentTime,size:c.commentFontSize,color:parseInt("0x"+c.commentColor),border:!0}),c.commentList[a]={date:parseInt(e.getTime()/1e3),time:1e3*c.video.currentTime,mode:c.commentMode,user:"-",pool:0,content:c.txtText.value},c.txtText.value="",c.txtText.disabled=!0,void t(function(){c.txtText.disabled=!1},c.commentCoolDown))};c.txtText.parentNode[i]("submit",function(e){return e.preventDefault(),$e(),!1}),c.btnSend[i]("click",$e),c.timeLabel[i]("click",function(){c.timeJump=r("input",{className:"time-jump"}),c.timeJump.value=p(c.video.currentTime),c.controlBar.appendChild(c.timeJump),c.timeJump[i]("blur",function(){c.timeJump&&c.timeJump.parentNode.removeChild(c.timeJump),c.timeJump=null}),c.timeJump[i]("keydown",function(e){if(13==e.keyCode){var t=v(c.timeJump.value);t&&t<=c.video.duration&&(c.video.currentTime=t,c.video.paused&&c.btnPlay.click()),c.timeJump.parentNode.removeChild(c.timeJump)}else(e.keyCode<48||e.keyCode>59)&&(e.keyCode<96||e.keyCode>105)&&8!=e.keyCode&&16!=e.keyCode&&37!=e.keyCode&&39!=e.keyCode&&46!=e.keyCode&&e.preventDefault()}),c.timeJump.focus(),c.timeJump.select()}),c.barTime.style.width="0%";var et=!1;c.barTimeHitArea[i]("mousedown",function(){et=!0});var tt={imgs:[],data:[],len:[0,0],size:[0,0]},at=!1;c.barTimeHitArea[i]("mouseenter",function(){at=!0}),c.barTimeHitArea[i]("mouseleave",function(){at=!1}),document[i]("mouseup",function(e){if(et){var t=(e.clientX-c.barTimeHitArea.getBoundingClientRect().left)/c.barTimeHitArea.offsetWidth*c.video.duration;0>t&&(t=0),Math.abs(t-c.video.currentTime)>4&&c.cmManager&&c.cmManager.clear(),c.video.currentTime=t}et=!1});var it=function(e){c.barTime.style.width=e/S.duration*100+"%",c.timeLabel.innerHTML=p(e)+" / "+p(S.duration)};document[i]("mousemove",function(e){var t=(e.clientX-c.barTimeHitArea.getBoundingClientRect().left)/c.barTimeHitArea.offsetWidth*c.video.duration;if(0>t&&(t=0),t>c.video.duration&&(t=c.video.duration),tt.data.length>0&&null!=s("ABP-Tooltip")&&at){var a;for(a=0;a<tt.data.length;a++)if(t<tt.data[a]){a--;break}var i=Math.floor(a/100),o=Math.floor(a%100/10),n=a%10,l=s("preview-container"),d=s("ABP-Tooltip");null==l&&(l=r("div",{id:"preview-container",style:{position:"absolute","background-size":tt.size[0]+"px "+tt.size[1]+"px",width:tt.size[0]+"px",height:tt.size[1]+"px",background:"rgba(0,0,0,0)",display:"none"}}),d.parentNode.insertBefore(l,d)),l.style.left=d.offsetLeft+(d.offsetWidth-tt.size[0])/2+"px",l.style.top=d.offsetTop+(d.offsetHeight-tt.size[1])+"px",l.style.display="block",l.style.backgroundImage='url("'+tt.imgs[i]+'")',l.style.backgroundPosition="-"+n*tt.size[0]+"px -"+o*tt.size[1]+"px"}null==s("ABP-Tooltip")&&null!=s("preview-container")&&(s("preview-container").style.display="none"),c.barTimeHitArea.tooltip(p(t)),et&&it(t)}),f(c.barTimeHitArea,!0,-12);var ot=!1;c.barVolumeHitArea[i]("mousedown",function(){ot=!0}),c.barVolume.style.width=100*c.video.volume+"%";var nt=function(e){c.barVolume.style.width=100*e+"%",c.video.muted=!1,c.btnVolume.className="button ABP-Volume icon-volume-",c.btnVolume.className+=.1>e?"mute":.33>e?"low":.67>e?"medium":"high",c.btnVolume.tooltip(ABP.Strings.mute),c.barVolumeHitArea.tooltip(parseInt(100*e)+"%"),Ze()};document[i]("mouseup",function(e){if(ot){var t=(e.clientX-c.barVolumeHitArea.getBoundingClientRect().left)/c.barVolumeHitArea.offsetWidth;0>t&&(t=0),t>1&&(t=1),c.video.volume=t,nt(c.video.volume)}ot=!1}),document[i]("mousemove",function(e){var t=(e.clientX-c.barVolumeHitArea.getBoundingClientRect().left)/c.barVolumeHitArea.offsetWidth;0>t&&(t=0),t>1&&(t=1),ot?(c.video.volume=t,nt(c.video.volume)):c.barVolumeHitArea.tooltip(parseInt(100*t)+"%")}),f(c.barVolumeHitArea,!0,-12);var lt=!1;c.barOpacityHitArea[i]("mousedown",function(){lt=!0}),c.barOpacity.style.width=100*c.cmManager.options.global.opacity+"%";var st=function(e){c.barOpacity.style.width=100*e+"%",c.barOpacityHitArea.tooltip(parseInt(100*e)+"%"),Ze()};document[i]("mouseup",function(e){if(lt){var t=(e.clientX-c.barOpacityHitArea.getBoundingClientRect().left)/c.barOpacityHitArea.offsetWidth;0>t&&(t=0),t>1&&(t=1),c.cmManager.options.global.opacity=t,st(c.cmManager.options.global.opacity),Ze()}lt=!1}),document[i]("mousemove",function(e){var t=(e.clientX-c.barOpacityHitArea.getBoundingClientRect().left)/c.barOpacityHitArea.offsetWidth;0>t&&(t=0),t>1&&(t=1),lt?(c.cmManager.options.global.opacity=t,st(c.cmManager.options.global.opacity)):c.barOpacityHitArea.tooltip(parseInt(100*t)+"%")}),f(c.barOpacityHitArea,!0,-6);var rt=!1;c.barScaleHitArea[i]("mousedown",function(){rt=!0}),c.barScale.style.width=(c.commentScale-.2)/1.8*100+"%";var ct=function(e){c.barScale.style.width=(e-.2)/1.8*100+"%",c.barScaleHitArea.tooltip(parseInt(100*e)+"%"),c.cmManager.setBounds(),Ze()};document[i]("mouseup",function(e){if(rt){var t=.2+1.8*(e.clientX-c.barScaleHitArea.getBoundingClientRect().left)/c.barScaleHitArea.offsetWidth;.2>t&&(t=.2),t>2&&(t=2),c.commentScale=t,ct(c.commentScale),Ze()}rt=!1}),document[i]("mousemove",function(e){var t=.2+1.8*(e.clientX-c.barScaleHitArea.getBoundingClientRect().left)/c.barScaleHitArea.offsetWidth;.2>t&&(t=.2),t>2&&(t=2),rt?(c.commentScale=t,ct(c.commentScale)):c.barScaleHitArea.tooltip(parseInt(100*t)+"%")}),f(c.barScaleHitArea,!0,-6);var dt=!1;c.barSpeedHitArea[i]("mousedown",function(){dt=!0}),c.barSpeed.style.width=(c.commentSpeed-.5)/1.5*100+"%";var mt=function(e){c.barSpeed.style.width=(e-.5)/1.5*100+"%",c.barSpeedHitArea.tooltip(parseInt(100*e)+"%"),c.cmManager.setBounds(),Ze()};document[i]("mouseup",function(e){if(dt){var t=.5+1.5*(e.clientX-c.barSpeedHitArea.getBoundingClientRect().left)/c.barSpeedHitArea.offsetWidth;.5>t&&(t=.5),t>2&&(t=2),c.commentSpeed=t,mt(c.commentSpeed),Ze()}dt=!1}),document[i]("mousemove",function(e){var t=.5+1.5*(e.clientX-c.barSpeedHitArea.getBoundingClientRect().left)/c.barSpeedHitArea.offsetWidth;.5>t&&(t=.5),t>2&&(t=2),dt?(c.commentSpeed=t,mt(c.commentSpeed)):c.barSpeedHitArea.tooltip(parseInt(100*t)+"%")}),f(c.barSpeedHitArea,!0,-6);var ut=!1;c.barPlaySpeedHitArea[i]("mousedown",function(){ut=!0}),c.barPlaySpeed.style.width=(c.video.playbackRate-.5)/1.5*100+"%";var pt=function(e){c.barPlaySpeed.style.width=(e-.5)/1.5*100+"%",c.barPlaySpeedHitArea.tooltip(e.toFixed(2)+"x")};document[i]("mouseup",function(e){if(ut){var t=.5+1.5*(e.clientX-c.barPlaySpeedHitArea.getBoundingClientRect().left)/c.barPlaySpeedHitArea.offsetWidth;.5>t&&(t=.5),t>2&&(t=2),c.video.playbackRate=t}ut=!1}),document[i]("mousemove",function(e){var t=.5+1.5*(e.clientX-c.barPlaySpeedHitArea.getBoundingClientRect().left)/c.barPlaySpeedHitArea.offsetWidth;.5>t&&(t=.5),t>2&&(t=2),ut?c.video.playbackRate=t:c.barPlaySpeedHitArea.tooltip(t.toFixed(2)+"x")}),f(c.barPlaySpeedHitArea,!0,-6),c.btnPlay[i]("click",function(){c.video.paused?c.video.play():c.video.pause()}),o[i]("keydown",function(e){if(e&&"INPUT"!=document.activeElement.tagName)switch(-1!=[27,32,37,38,39,40].indexOf(e.keyCode)&&e.preventDefault(),e.keyCode){case 27:abpinst.state.fullscreen&&abpinst.btnFull.click();break;case 32:c.btnPlay.click();break;case 37:var t=c.video.currentTime-=5*c.video.playbackRate;c.cmManager.clear(),0>t&&(t=0),c.video.currentTime=t.toFixed(3),c.video.paused&&c.btnPlay.click(),it(S.currentTime),c.barTimeHitArea.tooltip(p(S.currentTime));break;case 39:var t=c.video.currentTime+=5*c.video.playbackRate;c.cmManager.clear(),t>c.video.duration&&(t=c.video.duration),c.video.currentTime=t.toFixed(3),c.video.paused&&c.btnPlay.click(),it(S.currentTime),c.barTimeHitArea.tooltip(p(S.currentTime));break;case 38:var a=c.video.volume+.1;a>1&&(a=1),c.video.volume=a.toFixed(3),nt(c.video.volume);break;case 40:var a=c.video.volume-.1;0>a&&(a=0),c.video.volume=a.toFixed(3),nt(c.video.volume)}}),o.firstChild[i]("touchmove",function(e){e.preventDefault()});var vt=null;o[i]("touchstart",function(e){h(c.videoDiv,"ABP-HideCursor")&&y(c.videoDiv,"ABP-HideCursor"),e.targetTouches.length>0&&(vt=e.targetTouches[0])}),o[i]("touchend",function(e){if(g(c.videoDiv,"ABP-HideCursor"),e.changedTouches.length>0&&null!=vt){var t=e.changedTouches[0].pageX-vt.pageX,a=e.changedTouches[0].pageY-vt.pageY;if(Math.abs(t)<20&&Math.abs(a)<20)return void(vt=null);Math.abs(t)>3*Math.abs(a)?t>0?c.video.paused&&c.btnPlay.click():c.video.paused||c.btnPlay.click():Math.abs(a)>3*Math.abs(t)&&(c.video.volume=0>a?Math.min(1,c.video.volume+.1):Math.max(0,c.video.volume-.1)),
vt=null}}),o[i]("mouseup",function(){if("INPUT"!=document.activeElement.tagName){var e=window.scrollY;c.videoDiv.focus(),window.scrollTo(window.scrollX,e)}})}if("undefined"!=typeof CommentManager&&c.state.autosize){var ft=function(){if(0!==S.videoHeight&&0!==S.videoWidth){var e=S.videoHeight/S.videoWidth,t=o.offsetWidth,a=o.offsetHeight,i=a/t;e>i?(o.style.width=a/e+"px",o.style.height=a+"px"):(o.style.width=t+"px",o.style.height=t*e+"px"),c.cmManager.setBounds()}};S[i]("loadedmetadata",ft),ft()}if(window.cid&&window.WebSocket){var gt=new WebSocket("wss://chat.bilibili.com:8443/"+window.cid),ht=function(e){var t=parseInt(e.data.substr(0,4),16),a=e.data.substr(4);switch(t){case 1:c.playerUnit.querySelector(".ABP-Comment-List-Count span#viewer").innerHTML=a;case 8:break;case 2:var o=JSON.parse(a);o=[o[0].split(","),o[1]],o={border:!1,position:"absolute",stime:1e3*o[0][0],mode:1*o[0][1],size:1*o[0][2],color:1*o[0][3],date:1*o[0][4],whatTheHellIsThis:1*o[0][5],pool:1*o[0][6],hash:o[0][7],dbid:1*o[0][8],text:o[1]},8==o.mode&&(o.code=o.text,delete o.text);var n={date:o.date,time:o.stime,mode:o.mode,user:o.hash,pool:o.pool,content:o.text||o.code,originalData:o};c.cmManager.insert(o),shield.shield(),c.commentList[o.dbid]=n;var l=r("li",{}),s=r("span",{className:"cmt-time"},[r("text",p(n.time/1e3))]),d=r("span",{className:"cmt-content"},[r("text",n.content)]),m=r("span",{className:"cmt-date"},[r("text",u(n.date,!0))]);f(d,!1,36),f(m,!1,18),d.tooltip(n.content),m.tooltip(u(n.date)),l.appendChild(s),l.appendChild(d),l.appendChild(m),l.data=n,void 0!=o.code?l.style.background="#ffe100":0!=o.pool&&(l.style.background="#20ff20"),l[i]("dblclick",function(){c.video.currentTime=this.data.time/1e3,it(S.currentTime)}),c.commentObjArray.push(l);var v=c.commentListContainer,g=!1;v.parentNode.scrollTop+v.parentNode.offsetHeight==v.scrollHeight&&(g=!0),c.renderCommentList(),g&&(v.parentNode.scrollTop+=24),c.playerUnit.querySelector(".ABP-Comment-List-Count span#danmaku").innerHTML=c.commentObjArray.length;break;default:console.log("收到未知类型message: "+e.data)}},yt=function(){t(function(){gt=new WebSocket("wss://chat.bilibili.com:8443/"+window.cid),gt[i]("message",ht),gt[i]("close",yt)},5e3)};gt[i]("message",ht),gt[i]("close",yt),setInterval(function(){gt.send("01020004")},3e4)}var bt=function(){var e=c.state.widescreen,t=c.state.fullscreen,a=c.playerUnit.querySelector(".ABP-Player .ABP-Comment-List-Count"),i=c.playerUnit.querySelector(".ABP-Comment-List .ABP-Comment-List-Count");if(e||t)null!=i&&c.playerUnit.querySelector(".ABP-Player").appendChild(i);else if(null!=a){var o=c.playerUnit.querySelector(".ABP-Comment-List");o.insertBefore(a,o.childNodes[0])}};return c.controlBar[i]("click",bt),c.reconnectSocket=function(){gt.removeEventListener("close",yt),gt.close(),gt=new WebSocket("wss://chat.bilibili.com:8443/"+window.cid),gt[i]("message",ht),gt[i]("close",yt)},shield.init(c),c}}}}}}}}}}}}}}}}}}}}}}}}}}}(),function(e){var t=function(){var t='<div class="colpick"><div class="colpick_color"><div class="colpick_color_overlay1"><div class="colpick_color_overlay2"><div class="colpick_selector_outer"><div class="colpick_selector_inner"></div></div></div></div></div><div class="colpick_hue"><div class="colpick_hue_arrs"><div class="colpick_hue_larr"></div><div class="colpick_hue_rarr"></div></div></div><div class="colpick_new_color"></div><div class="colpick_current_color"></div><div class="colpick_hex_field"><div class="colpick_field_letter">#</div><input type="text" maxlength="6" size="6" /></div><div class="colpick_rgb_r colpick_field"><div class="colpick_field_letter">R</div><input type="text" maxlength="3" size="3" /><div class="colpick_field_arrs"><div class="colpick_field_uarr"></div><div class="colpick_field_darr"></div></div></div><div class="colpick_rgb_g colpick_field"><div class="colpick_field_letter">G</div><input type="text" maxlength="3" size="3" /><div class="colpick_field_arrs"><div class="colpick_field_uarr"></div><div class="colpick_field_darr"></div></div></div><div class="colpick_rgb_b colpick_field"><div class="colpick_field_letter">B</div><input type="text" maxlength="3" size="3" /><div class="colpick_field_arrs"><div class="colpick_field_uarr"></div><div class="colpick_field_darr"></div></div></div><div class="colpick_hsb_h colpick_field"><div class="colpick_field_letter">H</div><input type="text" maxlength="3" size="3" /><div class="colpick_field_arrs"><div class="colpick_field_uarr"></div><div class="colpick_field_darr"></div></div></div><div class="colpick_hsb_s colpick_field"><div class="colpick_field_letter">S</div><input type="text" maxlength="3" size="3" /><div class="colpick_field_arrs"><div class="colpick_field_uarr"></div><div class="colpick_field_darr"></div></div></div><div class="colpick_hsb_b colpick_field"><div class="colpick_field_letter">B</div><input type="text" maxlength="3" size="3" /><div class="colpick_field_arrs"><div class="colpick_field_uarr"></div><div class="colpick_field_darr"></div></div></div><div class="colpick_submit"></div></div>',a={showEvent:"click",onShow:function(){},onBeforeShow:function(){},onHide:function(){},onChange:function(){},onSubmit:function(){},colorScheme:"light",color:"3289c7",livePreview:!0,flat:!1,layout:"full",submit:1,submitText:"OK",height:156},l=function(t,a){var i=n(t);e(a).data("colpick").fields.eq(1).val(i.r).end().eq(2).val(i.g).end().eq(3).val(i.b).end()},r=function(t,a){e(a).data("colpick").fields.eq(4).val(Math.round(t.h)).end().eq(5).val(Math.round(t.s)).end().eq(6).val(Math.round(t.b)).end()},c=function(t,a){e(a).data("colpick").fields.eq(0).val(s(t))},d=function(t,a){e(a).data("colpick").selector.css("backgroundColor","#"+s({h:t.h,s:100,b:100})),e(a).data("colpick").selectorIndic.css({left:parseInt(e(a).data("colpick").height*t.s/100,10),top:parseInt(e(a).data("colpick").height*(100-t.b)/100,10)})},m=function(t,a){e(a).data("colpick").hue.css("top",parseInt(e(a).data("colpick").height-e(a).data("colpick").height*t.h/360,10))},u=function(t,a){e(a).data("colpick").currentColor.css("backgroundColor","#"+s(t))},p=function(t,a){e(a).data("colpick").newColor.css("backgroundColor","#"+s(t))},v=function(){var t,a=e(this).parent().parent();this.parentNode.className.indexOf("_hex")>0?(a.data("colpick").color=t=i(H(this.value)),l(t,a.get(0)),r(t,a.get(0))):this.parentNode.className.indexOf("_hsb")>0?(a.data("colpick").color=t=M({h:parseInt(a.data("colpick").fields.eq(4).val(),10),s:parseInt(a.data("colpick").fields.eq(5).val(),10),b:parseInt(a.data("colpick").fields.eq(6).val(),10)}),l(t,a.get(0)),c(t,a.get(0))):(a.data("colpick").color=t=o(T({r:parseInt(a.data("colpick").fields.eq(1).val(),10),g:parseInt(a.data("colpick").fields.eq(2).val(),10),b:parseInt(a.data("colpick").fields.eq(3).val(),10)})),c(t,a.get(0)),r(t,a.get(0))),d(t,a.get(0)),m(t,a.get(0)),p(t,a.get(0)),a.data("colpick").onChange.apply(a.parent(),[t,s(t),n(t),a.data("colpick").el,0])},f=function(){e(this).parent().removeClass("colpick_focus")},g=function(){e(this).parent().parent().data("colpick").fields.parent().removeClass("colpick_focus"),e(this).parent().addClass("colpick_focus")},h=function(t){t.preventDefault?t.preventDefault():t.returnValue=!1;var a=e(this).parent().find("input").focus(),i={el:e(this).parent().addClass("colpick_slider"),max:this.parentNode.className.indexOf("_hsb_h")>0?360:this.parentNode.className.indexOf("_hsb")>0?100:255,y:t.pageY,field:a,val:parseInt(a.val(),10),preview:e(this).parent().parent().data("colpick").livePreview};e(document).mouseup(i,b),e(document).mousemove(i,y)},y=function(e){return e.data.field.val(Math.max(0,Math.min(e.data.max,parseInt(e.data.val-e.pageY+e.data.y,10)))),e.data.preview&&v.apply(e.data.field.get(0),[!0]),!1},b=function(t){return v.apply(t.data.field.get(0),[!0]),t.data.el.removeClass("colpick_slider").find("input").focus(),e(document).off("mouseup",b),e(document).off("mousemove",y),!1},S=function(t){t.preventDefault?t.preventDefault():t.returnValue=!1;var a={cal:e(this).parent(),y:e(this).offset().top};e(document).on("mouseup touchend",a,P),e(document).on("mousemove touchmove",a,B);var i="touchstart"==t.type?t.originalEvent.changedTouches[0].pageY:t.pageY;return v.apply(a.cal.data("colpick").fields.eq(4).val(parseInt(360*(a.cal.data("colpick").height-(i-a.y))/a.cal.data("colpick").height,10)).get(0),[a.cal.data("colpick").livePreview]),!1},B=function(e){var t="touchmove"==e.type?e.originalEvent.changedTouches[0].pageY:e.pageY;return v.apply(e.data.cal.data("colpick").fields.eq(4).val(parseInt(360*(e.data.cal.data("colpick").height-Math.max(0,Math.min(e.data.cal.data("colpick").height,t-e.data.y)))/e.data.cal.data("colpick").height,10)).get(0),[e.data.preview]),!1},P=function(t){return l(t.data.cal.data("colpick").color,t.data.cal.get(0)),c(t.data.cal.data("colpick").color,t.data.cal.get(0)),e(document).off("mouseup touchend",P),e(document).off("mousemove touchmove",B),!1},C=function(t){t.preventDefault?t.preventDefault():t.returnValue=!1;var a={cal:e(this).parent(),pos:e(this).offset()};a.preview=a.cal.data("colpick").livePreview,e(document).on("mouseup touchend",a,A),e(document).on("mousemove touchmove",a,k);var i,o;return"touchstart"==t.type?(i=t.originalEvent.changedTouches[0].pageX,o=t.originalEvent.changedTouches[0].pageY):(i=t.pageX,o=t.pageY),v.apply(a.cal.data("colpick").fields.eq(6).val(parseInt(100*(a.cal.data("colpick").height-(o-a.pos.top))/a.cal.data("colpick").height,10)).end().eq(5).val(parseInt(100*(i-a.pos.left)/a.cal.data("colpick").height,10)).get(0),[a.preview]),!1},k=function(e){var t,a;return"touchmove"==e.type?(t=e.originalEvent.changedTouches[0].pageX,a=e.originalEvent.changedTouches[0].pageY):(t=e.pageX,a=e.pageY),v.apply(e.data.cal.data("colpick").fields.eq(6).val(parseInt(100*(e.data.cal.data("colpick").height-Math.max(0,Math.min(e.data.cal.data("colpick").height,a-e.data.pos.top)))/e.data.cal.data("colpick").height,10)).end().eq(5).val(parseInt(100*Math.max(0,Math.min(e.data.cal.data("colpick").height,t-e.data.pos.left))/e.data.cal.data("colpick").height,10)).get(0),[e.data.preview]),!1},A=function(t){return l(t.data.cal.data("colpick").color,t.data.cal.get(0)),c(t.data.cal.data("colpick").color,t.data.cal.get(0)),e(document).off("mouseup touchend",A),e(document).off("mousemove touchmove",k),!1},N=function(){var t=e(this).parent(),a=t.data("colpick").color;t.data("colpick").origColor=a,u(a,t.get(0)),t.data("colpick").onSubmit(a,s(a),n(a),t.data("colpick").el)},x=function(t){t.stopPropagation();var a=e("#"+e(this).data("colpickId"));a.data("colpick").onBeforeShow.apply(this,[a.get(0)]);var i=e(this).offset(),o=i.top+this.offsetHeight,n=i.left,l=_(),s=a.width();n+s>l.l+l.w&&(n-=s),a.css({left:n+"px",top:o+"px"}),0!=a.data("colpick").onShow.apply(this,[a.get(0)])&&a.show(),e("html").mousedown({cal:a},w),a.mousedown(function(e){e.stopPropagation()})},w=function(t){0!=t.data.cal.data("colpick").onHide.apply(this,[t.data.cal.get(0)])&&t.data.cal.hide(),e("html").off("mousedown",w)},_=function(){var e="CSS1Compat"==document.compatMode;return{l:window.pageXOffset||(e?document.documentElement.scrollLeft:document.body.scrollLeft),w:window.innerWidth||(e?document.documentElement.clientWidth:document.body.clientWidth)}},M=function(e){return{h:Math.min(360,Math.max(0,e.h)),s:Math.min(100,Math.max(0,e.s)),b:Math.min(100,Math.max(0,e.b))}},T=function(e){return{r:Math.min(255,Math.max(0,e.r)),g:Math.min(255,Math.max(0,e.g)),b:Math.min(255,Math.max(0,e.b))}},H=function(e){var t=6-e.length;if(t>0){for(var a=[],i=0;t>i;i++)a.push("0");a.push(e),e=a.join("")}return e},L=function(){var t=e(this).parent(),a=t.data("colpick").origColor;t.data("colpick").color=a,l(a,t.get(0)),c(a,t.get(0)),r(a,t.get(0)),d(a,t.get(0)),m(a,t.get(0)),p(a,t.get(0))};return{init:function(n){if(n=e.extend({},a,n||{}),"string"==typeof n.color)n.color=i(n.color);else if(void 0!=n.color.r&&void 0!=n.color.g&&void 0!=n.color.b)n.color=o(n.color);else{if(void 0==n.color.h||void 0==n.color.s||void 0==n.color.b)return this;n.color=M(n.color)}return this.each(function(){if(!e(this).data("colpickId")){var a=e.extend({},n);a.origColor=n.color;var i="collorpicker_"+parseInt(1e3*Math.random());e(this).data("colpickId",i);var o=e(t).attr("id",i);o.addClass("colpick_"+a.layout+(a.submit?"":" colpick_"+a.layout+"_ns")),"light"!=a.colorScheme&&o.addClass("colpick_"+a.colorScheme),o.find("div.colpick_submit").html(a.submitText).click(N),a.fields=o.find("input").change(v).blur(f).focus(g),o.find("div.colpick_field_arrs").mousedown(h).end().find("div.colpick_current_color").click(L),a.selector=o.find("div.colpick_color").on("mousedown touchstart",C),a.selectorIndic=a.selector.find("div.colpick_selector_outer"),a.el=this,a.hue=o.find("div.colpick_hue_arrs"),huebar=a.hue.parent();var s=navigator.userAgent.toLowerCase(),y="Microsoft Internet Explorer"===navigator.appName,b=y?parseFloat(s.match(/msie ([0-9]{1,}[\.0-9]{0,})/)[1]):0,B=y&&10>b,P=["#ff0000","#ff0080","#ff00ff","#8000ff","#0000ff","#0080ff","#00ffff","#00ff80","#00ff00","#80ff00","#ffff00","#ff8000","#ff0000"];if(B){var k,A;for(k=0;11>=k;k++)A=e("<div></div>").attr("style","height:8.333333%; filter:progid:DXImageTransform.Microsoft.gradient(GradientType=0,startColorstr="+P[k]+", endColorstr="+P[k+1]+'); -ms-filter: "progid:DXImageTransform.Microsoft.gradient(GradientType=0,startColorstr='+P[k]+", endColorstr="+P[k+1]+')";'),huebar.append(A)}else stopList=P.join(","),huebar.attr("style","background:-webkit-linear-gradient(top,"+stopList+"); background: -o-linear-gradient(top,"+stopList+"); background: -ms-linear-gradient(top,"+stopList+"); background:-moz-linear-gradient(top,"+stopList+"); -webkit-linear-gradient(top,"+stopList+"); background:linear-gradient(to bottom,"+stopList+"); ");o.find("div.colpick_hue").on("mousedown touchstart",S),a.newColor=o.find("div.colpick_new_color"),a.currentColor=o.find("div.colpick_current_color"),o.data("colpick",a),l(a.color,o.get(0)),r(a.color,o.get(0)),c(a.color,o.get(0)),m(a.color,o.get(0)),d(a.color,o.get(0)),u(a.color,o.get(0)),p(a.color,o.get(0)),a.flat?(o.appendTo(this).show(),o.css({position:"relative",display:"block"})):(o.appendTo(document.body),e(this).on(a.showEvent,x),o.css({position:"absolute"}))}})},showPicker:function(){return this.each(function(){e(this).data("colpickId")&&x.apply(this)})},hidePicker:function(){return this.each(function(){e(this).data("colpickId")&&e("#"+e(this).data("colpickId")).hide()})},setColor:function(t,a){if(a="undefined"==typeof a?1:a,"string"==typeof t)t=i(t);else if(void 0!=t.r&&void 0!=t.g&&void 0!=t.b)t=o(t);else{if(void 0==t.h||void 0==t.s||void 0==t.b)return this;t=M(t)}return this.each(function(){if(e(this).data("colpickId")){var i=e("#"+e(this).data("colpickId"));i.data("colpick").color=t,i.data("colpick").origColor=t,l(t,i.get(0)),r(t,i.get(0)),c(t,i.get(0)),m(t,i.get(0)),d(t,i.get(0)),p(t,i.get(0)),i.data("colpick").onChange.apply(i.parent(),[t,s(t),n(t),i.data("colpick").el,1]),a&&u(t,i.get(0))}})}}}(),a=function(e){var e=parseInt(e.indexOf("#")>-1?e.substring(1):e,16);return{r:e>>16,g:(65280&e)>>8,b:255&e}},i=function(e){return o(a(e))},o=function(e){var t={h:0,s:0,b:0},a=Math.min(e.r,e.g,e.b),i=Math.max(e.r,e.g,e.b),o=i-a;return t.b=i,t.s=0!=i?255*o/i:0,t.h=0!=t.s?e.r==i?(e.g-e.b)/o:e.g==i?2+(e.b-e.r)/o:4+(e.r-e.g)/o:-1,t.h*=60,t.h<0&&(t.h+=360),t.s*=100/255,t.b*=100/255,t},n=function(e){var t={},a=e.h,i=255*e.s/100,o=255*e.b/100;if(0==i)t.r=t.g=t.b=o;else{var n=o,l=(255-i)*o/255,s=(n-l)*(a%60)/60;360==a&&(a=0),60>a?(t.r=n,t.b=l,t.g=l+s):120>a?(t.g=n,t.b=l,t.r=n-s):180>a?(t.g=n,t.r=l,t.b=l+s):240>a?(t.b=n,t.r=l,t.g=n-s):300>a?(t.b=n,t.g=l,t.r=l+s):360>a?(t.r=n,t.g=l,t.b=n-s):(t.r=0,t.g=0,t.b=0)}return{r:Math.round(t.r),g:Math.round(t.g),b:Math.round(t.b)}},l=function(t){var a=[t.r.toString(16),t.g.toString(16),t.b.toString(16)];return e.each(a,function(e,t){1==t.length&&(a[e]="0"+t)}),a.join("")},s=function(e){return l(n(e))};e.fn.extend({colpick:t.init,colpickHide:t.hidePicker,colpickShow:t.showPicker,colpickSetColor:t.setColor}),e.extend({colpick:{rgbToHex:l,rgbToHsb:o,hsbToHex:s,hsbToRgb:n,hexToHsb:i,hexToRgb:a}})}(jQuery);